# 图像分类标注工具 (Image Classification Tool)

这是一个使用 PyQt5 构建的图形化工具，旨在帮助用户快速、高效地对本地图像文件进行手动分类和标注。

## 主要功能

- **图形化操作界面**：提供直观的用户界面，易于上手。
- **灵活的配置**：启动时可自由设置待分类图片的源路径、分类后的输出路径以及自定义的类别名称。
- **多格式支持**：支持 `.png`, `.jpg`, `.jpeg`, `.bmp` 等多种常见的图像格式。
- **上下文预览**：主界面同时展示当前图片、上一张图片以及后两张图片，方便在分类时进行上下文比对。
- **高效的分类操作**：
    - 通过点击类别按钮或使用数字快捷键 (1-9) 快速完成分类。
    - 分类后自动跳转到下一张未分类的图片。
- **便捷的导航**：
    - 使用“上一张”/“下一张”按钮或键盘左右箭头 (`←`/`→`) 切换图片。
    - 点击左侧文件列表，可直接跳转到任意一张图片。
- **动态类别**：支持在标注过程中随时通过对话框动态添加新的分类。
- **撤销操作**：支持通过按钮或快捷键 (`Ctrl+Z`) 撤销上一次的分类动作。
- **图像缩放**：按住 `Ctrl` 键并滚动鼠标滚轮，可以对当前主图像进行缩放。
- **状态记忆**：
    - 自动保存用户输入的路径和类别配置，方便下次启动时使用。
    - 程序启动时会扫描输出目录，自动加载已有的分类进度，支持断点续标。
- **日志记录**：可选择将详细的操作日志输出到控制台或保存在输出目录下的 `labeler.log` 文件中，便于追踪和审计。

## 运行环境要求

- Python 3.x
- PyQt5

## 安装与使用

1.  **安装依赖库**：
    ```bash
    pip install PyQt5
    ```

2.  **运行程序**：
    ```bash
    python <脚本文件名>.py
    ```

3.  **初始设置**：
    程序启动后会弹出一个“参数设置”对话框，请填写以下信息：
    - **待分类图像路径**：选择包含所有待分类图片的文件夹。
    - **分类后保存路径**：选择一个用于存放分类结果的文件夹。程序会自动在此路径下根据类别名称创建子文件夹。
    - **类别名称**：输入所有预设的类别名称，并用 **单个空格** 分隔。例如：`red black other`。
    - **日志选项**：根据需要勾选日志记录方式。

4.  **进行分类**：
    - **查看图片**：中间区域会显示图片，其中带蓝色边框的为当前待分类的主图。
    - **分类**：点击底部的类别按钮，或按下对应的数字键（例如，按 `1` 键将图片分到第一个类别），即可将当前图片复制到对应类别的文件夹下，并自动切换到下一张。
    - **导航**：使用 `←` 和 `→` 键在图片间导航。
    - **撤销**：如果分错了，可以按 `Ctrl+Z` 撤销上一步操作。

## 快捷键总览

| 快捷键             | 功能                         |
| ------------------ | ---------------------------- |
| `←` (左箭头)         | 查看上一张图片               |
| `→` (右箭头)         | 查看下一张图片               |
| `1`, `2`, `3` ... `9` | 将当前图片分到对应的类别     |
| `Ctrl` + `Z`         | 撤销上一次的分类操作         |
| `Ctrl` + `鼠标滚轮`    | 缩放当前主图像               |

## 工作原理

- **文件操作**：本工具通过 **复制 (`shutil.copy2`)** 的方式将源图片归类到输出路径下的相应子文件夹中。这个过程 **不会以任何方式修改或删除您的原始图片**。
- **状态恢复**：程序启动时，会扫描指定的输出目录。如果发现某个图片文件已经存在于某个类别子文件夹中，程序会记录其分类状态。这使得您可以随时关闭程序，下次打开时能继续上一次的进度。
- **日志系统**：如果启用了日志功能，程序的所有关键操作（如程序启动、加载配置、分类图片、撤销操作等）都会被详细记录下来。

## 代码结构

- `StartupDialog` 类:
  负责在程序启动时显示设置对话框，收集并校验用户输入（如路径、类别），并将配置传递给主窗口。
- `ClassificationWindow` 类:
  程序的主窗口，负责所有核心功能，包括：
  - 加载和显示图片。
  - 创建并管理界面控件（按钮、列表、标签等）。
  - 处理用户的交互事件（点击、键盘输入）。
  - 执行图片的分类、文件复制和撤销逻辑。
  - 更新进度和状态显示。
